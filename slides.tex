%!TEX encoding=UTF-8 Unicode
\input{custom/magic}
\documentclass[xcolor={usenames,dvipsnames},hyperref={pdfusetitle}]{beamer}
\usepackage{lmodern}

%=========================Language and encoding ==============================

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
% Fix size errors due to T1 in bbl file
\usepackage{fix-cm}
\usepackage{siunitx}
%=============================================================================

%========================= Todo notes  =======================================

\input{custom/macros.tex}
\usepackage{todonotes}
\presetkeys{todonotes}{inline}{}

%=============================================================================

%========================= Figures ===========================================

\usepackage[]{caption}
\usepackage[]{subcaption}
\usepackage{graphicx} % support the \includegraphics command and options
\graphicspath{{./img/}{./style/}{./tikz/}}
\input{custom/tikz}
\input{custom/algo.tex}
\usepackage{epstopdf}
\usepackage{booktabs}
\usepackage{multirow}
%\usepackage{subcaption}

%=============================================================================

%=============================================================================

%========================= Hyperref ==========================================


%\hypersetup{
%    colorlinks=false, %colore les liens
%    breaklinks=true, %permet le retour Ã  la ligne dans les liens trop longs
%    urlcolor= blue, %couleur des hyperliens
%    %linkcolor= black, %couleur des liens internes
%    bookmarksopen=true,
%    citecolor=black,
%}
%=============================================================================

%========================= Other useful includes =============================

\usepackage{ifthen}
\usepackage[absolute,overlay]{textpos} %to set some blocks position
%=============================================================================

%========================= Beamer theme =====================================

%Stuff for printable version
\mode<handout>{
    \usetheme{default}
    \setbeamercolor{background canvas}{bg=black!5}
    \pgfpagesuselayout{4 on 1}[a4paper,landscape,border shrink=2.5mm]
}

\usetheme{AntibesCompact}

\definecolor{INstruct}{HTML}{82A382}
\setbeamercolor{structure}{fg=INstruct}

\newcommand{\alertitem}{\item<+-|alert@+>}
\newcommand\alertblockat[3]{
    \alt#1{
        \begin{alertblock}{#2}
            #3
        \end{alertblock}
    }{
        \begin{block}{#2}
            #3
        \end{block}
    }
}

%=============================================================================

%========================= Title frame  ======================================
\title[]{Analyzing the memory behavior of parallel scientific applications}
\author[David Beniamine]{\textbf{David Beniamine}}
\institute[Polaris / Datamove]{
    \includegraphics[height=.10\textheight]{img/logoUGA.jpg}
    \quad
    \includegraphics[width=.10\textwidth]{img/LIG_coul.jpg}
    \quad
    \includegraphics[width=.15\textwidth]{img/inria.jpg}
    \quad
    \includegraphics[width=.18\textwidth]{img/polaris.png}
    \quad
    \includegraphics[width=.18\textwidth]{img/datamove.png}
}


\newcommand{\enableTocAtSection}{
    \AtBeginSection[]
    {
        \ifthenelse{\boolean{sectiontoc}}{
            \begin{frame}<beamer>
                \frametitle{Outline}
                \tableofcontents[currentsection,currentsubsection]
            \end{frame}
        }
    }
    \AtBeginSubsection[]
    {
        \ifthenelse{\boolean{sectiontoc}}{
            \begin{frame}<beamer>
                \frametitle{Outline}
                \tableofcontents[currentsection,currentsubsection]
            \end{frame}
        }
    }
}

%=============================================================================

\begin{document}
%========================= Title and outlines ================================
\begin{frame}{}
    \titlepage
\small
{\centering\itshape Jury members\par}
\begin{tabular}[t]{@{}l@{\hspace{3pt}}p{.45\textwidth}@{}}
President: & Pr, Martin Quinson\\
Reviewers: & Pr, Jes\'us Labarta Mancho \\
& Pr,  Raymond Namyst \\
Examiners: & Dr, Lucas M. Schnorr \\
\end{tabular}%
\begin{tabular}[t]{@{}l@{\hspace{3pt}}p{.45\textwidth}@{}}
Supervisors: & Pr, Bruno Raffin \\
 & Dr, Guillaume Huard
\end{tabular}%
\end{frame}

\newboolean{sectiontoc}
\setboolean{sectiontoc}{true} % default to true

%=============================================================================

%========================= Real presentation =================================

\section{Context}

\begin{frame}{Scientific applications and performances}
    \todo{Put something here}
\end{frame}

\begin{frame}{Improving sequential computer performances}
    \begin{columns}
        \begin{column}{.45\textwidth}
            \centering
            \input{tikz/topo-naive}
        \end{column}
        \begin{column}{.45\textwidth}
            \pause
            \begin{block}{Increase cpu frequency}
                \begin{itemize}[<+->]
                    \item Done for years
                    \alertitem Gap CPU / Memory
                    \begin{itemize}
                        \alertitem Add memory caches
                    \end{itemize}
                    \alertitem Physical limits
                        \begin{itemize}
                            \alertitem Energy consumption
                            \alertitem Heat dissipation
                        \end{itemize}
                \end{itemize}
            \end{block}
            \uncover<8->{
                \begin{alertblock}{Build parallel machines}
                    Writing efficient code becomes complex
                \end{alertblock}
            }
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{An simple example}
    \centering
    \scalebox{.6}{
        \input{tikz/mat-mult}
    }
\end{frame}

\begin{frame}{Parallel and NUMA machines}
    \centering
    \scalebox{.6}{
        \input{tikz/topo-NUMA.tex}
    }
    \pause
\end{frame}

\begin{frame}{Research statement}
    \begin{alertblock}{Statement}
        How can we analyze the memory behavior of an application to optimize its performances ?
    \end{alertblock}
    \pause
    \begin{block}{Challenges}
        \begin{itemize}[<+->]
                \alertitem Collect memory traces
                \begin{itemize}
                    \item \textbf{Complete}: do not miss part of the address space
                    \item \textbf{Precise}:  enough to detect patterns
                    \item \textbf{Detailed}: embed all meta data about the access
                \end{itemize}
                \alertitem Visualize memory traces
                \alertitem Take advantage of the obtained knowledge
        \end{itemize}
    \end{block}
\end{frame}

\enableTocAtSection
\begin{frame}{Outline}
    \tableofcontents
\end{frame}

\section{State of the art}

\begin{frame}{Generic performance analysis tools}
    \alertblockat{<1>}{Low level trace collection}{
        \begin{itemize}
            \item Likwid~\cite{Treibig10LIKWID}
            \item PAPI~\cite{Browne00Portable}
        \end{itemize}
    }
    \pause
    \alertblockat{<2>}{Higher level tools}{
        \begin{itemize}
            \item VTune~\cite{Reinders05VTune}
            \item HPCToolkit~\cite{Adhianto10HPCTOOLKIT}
            \item PARAVER~\cite{Pillet95PARAVER}
            \item MAQAO~\cite{Djoudi05MAQAO}
        \end{itemize}
    }
    \pause
    \begin{alertblock}{Limitations}
        Indirect information on the memory usage using  CPU performance counters
    \end{alertblock}
\end{frame}

\begin{frame}{Existing memory profiling tools}
    \begin{block}{Instruction sampling~\cite{Drongowski07Instructionbased,Levinthal09Performance}}
        \begin{itemize}
            \item  MemPhis~\cite{McCurdy10Memphis}
            \item  MemProf~\cite{Lachaize12MemProf}
            \item  HPCToolkit extension~\cite{Liu14Tool}
            \item  MemAxes / Mitos~\cite{Gimenez14Dissecting}
        \end{itemize}
    \end{block}
    \pause 
    \begin{alertblock}{Limitations}
        \begin{itemize}
            \item Not complete: miss significant part of memory
            \item Not precise enough for pattern analysis
        \end{itemize}
    \end{alertblock}
\end{frame}

\section{Analyzing the global memory behavior}

\subsection{Tabarnac}

\begin{frame}{Trace collection mechanism}
    \begin{itemize}[<+-|alert@+>]
        \item Aims at improving performances on NUMA machines
        \item Pin~\cite{Luk05Pin} instrumentation
        \item Based on Numalyze~\cite{Diener15Characterizing}
        \item Collects 1 counter per page and per threads
        \item Lock free
        \item Differentiate access types (reads / writes)
        \item Retrieve data structure information
    \end{itemize}
\end{frame}

\begin{frame}{Visualizations}
    \alt<1>{
        \begin{columns}
            \begin{column}{.45\linewidth}
                \centering
                \includegraphics[width=\linewidth]{img/tabarnac/example_sz.png}
            \end{column}
            \begin{column}{.45\linewidth}
                \includegraphics[width=\linewidth]{img/tabarnac/example_rw.png}
            \end{column}
        \end{columns}
    }{
        \centering
        \alt<2>{
            \includegraphics[height=.7\textheight]{img/tabarnac/example_ft.png}
            \begin{block}{}
                First touch distribution for one data structure
            \end{block}
        }{
            \includegraphics[height=.75\textheight]{img/tabarnac/is_b_kb2_orig.png}
            \begin{block}{}
                Accesses distribution for one data structure
            \end{block}
        }
    }
    \pause
    \pause
\end{frame}

\subsection{Using Tabarnac to optimize a well known benchmark}

\begin{frame}{First analysis}
\begin{figure}[htb]
    \begin{columns}
        \begin{column}{.45\linewidth}
            \includegraphics[width=\linewidth]  {tabarnac/is_b_kb2_orig}
        \end{column}
        \begin{column}{.45\linewidth}
            \includegraphics[width=\linewidth]  {tabarnac/is_b_kb1_orig}
        \end{column}
    \end{columns}
\end{figure}

\end{frame}

\begin{frame}{Issue and optimization}
    \alt<1-2>{
        \scalebox{.8}{
            \centering
            \input{tikz/is-curve-nocolor}
        }
        \pause
        \begin{block}{Original code}
            \#pragma omp for schedule(dynamic)
        \end{block}
    }{
        \scalebox{.8}{
            \centering
            \input{tikz/is-curve}
        }        \begin{block}{Modified code}
            \#pragma omp for schedule(static, size/(2*num\_threads))
        \end{block}
    }
    \pause
\end{frame}

\begin{frame}{Second analysis}
    \begin{columns}
        \begin{column}{.45\linewidth}
            \includegraphics[width=\linewidth]  {tabarnac/is_b_kb2_modif}
        \end{column}
        \begin{column}{.45\linewidth}
            \includegraphics[width=\linewidth]  {tabarnac/is_b_kb1_modif}
        \end{column}
    \end{columns}
\end{frame}

\begin{frame}{Results}
    \includegraphics[width=\linewidth]{tabarnac/is_exectime}
\end{frame}

\begin{frame}{Conclusions}
    \begin{itemize}[<+-|alert@+>]
        \item Collaboration with M. Diener, UFRGS, P.O.A, Brasil
        \item Improved trace collection tool
        \item Simple yet meaningful visualization
        \item Enables significant optimizations
        \item Published at VPA'15~\cite{Beniamine15TABARNAC}
    \end{itemize}
    \uncover<6->{
        \begin{alertblock}{Limitations}
            \begin{itemize}
                \item No temporal informations
                \item Cannot detect precise sharing
            \end{itemize}
        \end{alertblock}
    }
\end{frame}

\section{Collecting and analyzing fine grained traces}

\subsection{Moca an efficient memory trace collection system}

\begin{frame}{Background knowledge}
    <++>
\end{frame}

\begin{frame}{Design}
    <++>
\end{frame}

\begin{frame}{Handling page faults}
    <++>
\end{frame}


\begin{frame}{Experimental setup}
    <++>
\end{frame}

\begin{frame}{Experimental results: trace precision}
    <++>
\end{frame}

\begin{frame}{Experimental results: overhead}
    <++>
\end{frame}

\subsection{Visualizing and analyzing Moca traces}

\begin{frame}{Framesoc / Ocelotl}
    <++>
\end{frame}

\begin{frame}{Example: Matrix multiplication}
    <++>
\end{frame}

\begin{frame}{Limits}
    <++>
\end{frame}

\begin{frame}{Programmatic approach}
    <++>
\end{frame}

\begin{frame}{Example: ??}
    <++>
\end{frame}

\section{Conclusions and perspectives}

\begin{frame}{Global overview}
    \cite{Beniamine15TABARNAC}
    <++>
\end{frame}

\begin{frame}{Fine trace collecion}
    \cite{Beniamine16Moca}
    <++>
\end{frame}

\begin{frame}{Trace analysis}
    <++>
\end{frame}

\begin{frame}{Perspectives}
    <++>
\end{frame}

\newcounter{finalframe}
\setcounter{finalframe}{\value{framenumber}}
%Last numbered frame go here

\begin{frame}{Perspectives}
\end{frame}
%=============================================================================

%=============================================================================
%Uncomment next lines for uncounted backup slides & biblio
\section*{Bibliography}
%
\bibliographystyle{apalike}
\bibliography{biblio}

%========================= Backup slides =====================================
\section*{Hidden slides}
%put this line before each frame
%\setcounter{framenumber}{\value{finalframe}}

\subsection*{Tabarnac}

\setcounter{framenumber}{\value{finalframe}}
\begin{frame}{Experimental setup}
    \small
    \centering
    \begin{tabular}{lccccc}
        \toprule
        & \multicolumn{5}{c}{\textbf{Hardware totals}}\\
        \cmidrule(lr){2-6}
        & Nodes & Threads & Vendor & Model & Memory \\
        \cmidrule(lr){2-6}
        \texttt{Turing}   & $4$ & $64$ & Intel & Xeon X7550   & \SI{128}{Gib} \\
        \texttt{Idfreeze} & $8$ & $48$ & AMD   & Opteron 6174 & \SI{256}{Gib}\\
        \midrule
        & \multicolumn{5}{c}{\textbf{Hardware per node}}\\
        \cmidrule(lr){2-6}
        & Cores & Threads & Frequency & L3 Cache & Memory \\
        \cmidrule(lr){2-6}
        \texttt{Turing}   & $8$ & $16$ & \SI{2.00}{Ghz}& \SI{18}{Mib} & \SI{32}{Gib} \\
        \texttt{Idfreeze} & $6$ & $6$  & \SI{2.20}{Ghz}& \SI{12}{Mib} & \SI{32}{Gib}\\
        \midrule
        & \multicolumn{5}{c}{\textbf{Software}}\\
        \cmidrule(lr){2-6}
        & Kernel & \multicolumn{2}{c}{Distribution} &
        \multicolumn{2}{c}{Bios configurations} \\
        \cmidrule(lr){2-6}
        \texttt{Turing}   & Linux 3.13 & \multicolumn{2}{c}{Ubuntu 12.04} &
        \multicolumn{2}{c}{Hyper threading} \\
        \texttt{Idfreeze} & Linux 3.2 & \multicolumn{2}{c}{Debian Jessie} &
        \multicolumn{2}{c}{No hyper threading}\\
        \bottomrule
    \end{tabular}
\end{frame}

\setcounter{framenumber}{\value{finalframe}}
\begin{frame}{Tabarnac overhead}
    \includegraphics[width=\linewidth]{tabarnac/tool-ovh.pdf}
\end{frame}

%=============================================================================
\end{document}




