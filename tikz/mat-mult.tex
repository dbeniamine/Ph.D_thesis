%!TEX encoding=UTF-8 Unicode

\definecolor{ColI}{HTML}{1B9E77}
\definecolor{ColK}{HTML}{D95F02}
\definecolor{ColJ}{HTML}{7570B3}

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,foreground}


\tikzstyle{PrimaryA}   = [-latex,very thick]
\tikzstyle{SecondaryA} = [-latex,very thick,dashed]

\newcommand{\coli}[1]{\textcolor{ColI}{#1}}
\newcommand{\colj}[1]{\textcolor{ColJ}{#1}}
\newcommand{\colk}[1]{\textcolor{ColK}{#1}}

% #1: name, #2: start pos, #3: size
\newcommand{\matgrid}[3]{
        \draw #2 grid ($#2+(#3,#3)$);
        % Four corners
        \coordinate (m#1-00) at ($#2+(0.5,0.5)$);
        \coordinate (m#1-0N) at ($#2+(0.5,#3-0.5)$);
        \coordinate (m#1-N0) at ($#2+(#3-0.5,0.5)$);
        \coordinate (m#1-NN) at ($#2+(#3-0.5,#3-0.5)$);

        \node (#1) at ($(m#1-00)+(-1,0)$){#1};

        \node (#1) at ($(m#1-0N)+(-.2,.2)$)  {0};
        \node (#1) at ($(m#1-00)+(0,-.2)$) {N-1};
        \node (#1) at ($(m#1-NN)+(.2,0)$)  {N-1};
}


\begin{tikzpicture}[font=\small]

    \begin{pgfonlayer}{background}
        \node[draw,rounded corners] at (2.5,9){%
            \begin{varwidth}{\linewidth}
                \begin{algorithmic}
                    \For{\coli{i in 0..N-1}}
                    \For{\colj{j in 0..N-1}}
                    \For{\colk{k in 0..N-1}}
                    \State C[\coli{i},\colj{j}] += A[\coli{i},\colk{k}] * B[\colk{k},\colj{j}]
                            \EndFor
                        \EndFor
                    \EndFor
                \end{algorithmic}%
            \end{varwidth}%
        };

        \matgrid{A}{(0,0)}{5}
        \matgrid{B}{(6,6)}{5}
        \matgrid{C}{(6,0)}{5}

    \end{pgfonlayer}

    % Indexes

    \begin{pgfonlayer}{foreground}
        %% A
        \draw[PrimaryA,ColI]   (mA-0N) -- node [above] {i} (mA-NN);
        \draw[SecondaryA,ColK] (mA-0N) -- node [left]  {k} (mA-00);

        %% B
        \draw[PrimaryA,ColJ]   (mB-0N) -- node [left]  {j} (mB-00);
        \draw[SecondaryA,ColK] (mB-0N) -- node [above] {k} (mB-NN);

        %% C
        \draw[PrimaryA,ColI]   (mC-0N) -- node [above] {i} (mC-NN);
        \draw[SecondaryA,ColJ] (mC-0N) -- node [left]  {j} (mC-00);
    \end{pgfonlayer}

\end{tikzpicture}
% vim: et si sta lbr  sw=4 ts=4 spelllang=en_us
